<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Verify Your Information — TalentMatch</title>

    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
          href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans:wght@400;500;700;900&amp;family=Spline+Sans:wght@400;500;700" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <style>
        :root {
            --accent: #2d608f;
            --muted: #6a7681;
            --success: #10b981;
            --success-light: #d1fae5;
        }

        body {
            font-family: "Spline Sans", "Noto Sans", sans-serif;
        }
        /* From Uiverse.io by mobinkakei */
        #wifi-loader {
            --background: #62abff;
            --front-color: #4f29f0;
            --back-color: #c3c8de;
            --text-color: #414856;
            width: 64px;
            height: 64px;
            border-radius: 50px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(45,96,143,0.95), rgba(98,171,255,0.95));
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #wifi-loader svg {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #wifi-loader svg circle {
            position: absolute;
            fill: none;
            stroke-width: 6px;
            stroke-linecap: round;
            stroke-linejoin: round;
            transform: rotate(-100deg);
            transform-origin: center;
        }

        #wifi-loader svg circle.back {
            stroke: var(--back-color);
        }

        #wifi-loader svg circle.front {
            stroke: var(--front-color);
        }

        #wifi-loader svg.circle-outer {
            height: 86px;
            width: 86px;
        }

        #wifi-loader svg.circle-outer circle {
            stroke-dasharray: 62.75 188.25;
        }

        #wifi-loader svg.circle-outer circle.back {
            animation: circle-outer135 1.8s ease infinite 0.3s;
        }

        #wifi-loader svg.circle-outer circle.front {
            animation: circle-outer135 1.8s ease infinite 0.15s;
        }

        #wifi-loader svg.circle-middle {
            height: 60px;
            width: 60px;
        }

        #wifi-loader svg.circle-middle circle {
            stroke-dasharray: 42.5 127.5;
        }

        #wifi-loader svg.circle-middle circle.back {
            animation: circle-middle6123 1.8s ease infinite 0.25s;
        }

        #wifi-loader svg.circle-middle circle.front {
            animation: circle-middle6123 1.8s ease infinite 0.1s;
        }

        #wifi-loader svg.circle-inner {
            height: 34px;
            width: 34px;
        }

        #wifi-loader svg.circle-inner circle {
            stroke-dasharray: 22 66;
        }

        #wifi-loader svg.circle-inner circle.back {
            animation: circle-inner162 1.8s ease infinite 0.2s;
        }

        #wifi-loader svg.circle-inner circle.front {
            animation: circle-inner162 1.8s ease infinite 0.05s;
        }

        #wifi-loader .text {
            position: absolute;
            bottom: -40px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-transform: lowercase;
            font-weight: 500;
            font-size: 14px;
            letter-spacing: 0.2px;
        }

        #wifi-loader .text::before, #wifi-loader .text::after {
            content: attr(data-text);
        }

        #wifi-loader .text::before {
            color: var(--text-color);
        }

        #wifi-loader .text::after {
            color: var(--front-color);
            animation: text-animation76 3.6s ease infinite;
            position: absolute;
            left: 0;
        }

        @keyframes circle-outer135 {
            0% {
                stroke-dashoffset: 25;
            }

            25% {
                stroke-dashoffset: 0;
            }

            65% {
                stroke-dashoffset: 301;
            }

            80% {
                stroke-dashoffset: 276;
            }

            100% {
                stroke-dashoffset: 276;
            }
        }

        @keyframes circle-middle6123 {
            0% {
                stroke-dashoffset: 17;
            }

            25% {
                stroke-dashoffset: 0;
            }

            65% {
                stroke-dashoffset: 204;
            }

            80% {
                stroke-dashoffset: 187;
            }

            100% {
                stroke-dashoffset: 187;
            }
        }

        @keyframes circle-inner162 {
            0% {
                stroke-dashoffset: 9;
            }

            25% {
                stroke-dashoffset: 0;
            }

            65% {
                stroke-dashoffset: 106;
            }

            80% {
                stroke-dashoffset: 97;
            }

            100% {
                stroke-dashoffset: 97;
            }
        }

        @keyframes text-animation76 {
            0% {
                clip-path: inset(0 100% 0 0);
            }

            50% {
                clip-path: inset(0);
            }

            100% {
                clip-path: inset(0 0 0 100%);
            }
        }


        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: none; }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: none; }
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(45,96,143,0.2); }
            50% { box-shadow: 0 0 30px rgba(45,96,143,0.4); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .anim-fade { animation: fadeInUp 0.8s cubic-bezier(0.2, 0.9, 0.2, 1) both; }
        .anim-slide { animation: slideInLeft 0.6s cubic-bezier(0.2, 0.9, 0.2, 1) both; }

        .progress-bar {
            background: linear-gradient(90deg, #f1f3f5 0%, #e1e5e9 100%);
            border-radius: 12px;
            height: 8px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, #4b7bb4 50%, var(--accent) 100%);
            background-size: 200% 100%;
            animation: shimmer 2s ease-in-out infinite;
            border-radius: 12px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card {
            backdrop-filter: blur(8px);
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.8) 100%);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, #4b7bb4 100%);
            color: white;
            border: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 100%);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .btn-primary:hover::before {
            transform: translateX(100%);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45,96,143,0.3);
        }

        .btn-secondary {
            background: rgba(45,96,143,0.1);
            color: var(--accent);
            border: 2px solid var(--accent);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-2px);
        }

        .form-input {
            transition: all 0.3s ease;
            border: 2px solid #e1e5e9;
        }

        .form-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(45,96,143,0.1);
            outline: none;
        }

        .job-tag {
            background: linear-gradient(135deg, rgba(45,96,143,0.1) 0%, rgba(75,123,180,0.1) 100%);
            border: 1px solid rgba(45,96,143,0.2);
            color: var(--accent);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .job-tag:hover {
            background: linear-gradient(135deg, var(--accent) 0%, #4b7bb4 100%);
            color: white;
            transform: translateY(-2px);
        }

        .job-tag.selected {
            background: linear-gradient(135deg, var(--accent) 0%, #4b7bb4 100%);
            color: white;
            animation: pulseGlow 2s ease-in-out infinite;
        }

        .step-indicator {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step-indicator.active {
            background: var(--accent);
            color: white;
            animation: pulseGlow 1.5s ease-in-out infinite;
        }

        .step-indicator.completed {
            background: var(--success);
            color: white;
        }

        .step-indicator.inactive {
            background: #f1f3f5;
            color: var(--muted);
        }

        .success-animation {
            animation: fadeInUp 0.6s ease, pulseGlow 2s ease-in-out infinite 0.6s;
        }

        /* Custom select styling */
        .custom-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px 16px;
            padding-right: 40px;
        }

        @media (max-width: 768px) {
            .container { padding: 0 16px; }
            .verification-card { margin: 16px; }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-indigo-50 min-h-screen">
<!-- Loader -->
<div id="loader" class="loader hidden">
    <div id="wifi-loader">
        <svg class="circle-outer" viewBox="0 0 86 86" xmlns="http://www.w3.org/2000/svg">
            <circle class="back" cx="43" cy="43" r="40"></circle>
            <circle class="front" cx="43" cy="43" r="40"></circle>
            <circle class="new" cx="43" cy="43" r="40"></circle>
        </svg>
        <svg class="circle-middle" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
            <circle class="back" cx="30" cy="30" r="27"></circle>
            <circle class="front" cx="30" cy="30" r="27"></circle>
        </svg>
        <svg class="circle-inner" viewBox="0 0 34 34" xmlns="http://www.w3.org/2000/svg">
            <circle class="back" cx="17" cy="17" r="14"></circle>
            <circle class="front" cx="17" cy="17" r="14"></circle>
        </svg>
        <div class="text" data-text="Processing your CV...">Processing your CV...</div>
    </div>
</div>


<!-- Header -->
<header class="bg-white/80 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <div class="w-8 h-8 text-[#2d608f]">
                <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M44 11.2727C44 14.0109 39.8386 16.3957 33.69 17.6364C39.8386 18.877 44 21.2618 44 24C44 26.7382 39.8386 29.123 33.69 30.3636C39.8386 31.6043 44 33.9891 44 36.7273C44 40.7439 35.0457 44 24 44C12.9543 44 4 40.7439 4 36.7273C4 33.9891 8.16144 31.6043 14.31 30.3636C8.16144 29.123 4 26.7382 4 24C4 21.2618 8.16144 18.877 14.31 17.6364C8.16144 16.3957 4 14.0109 4 11.2727C4 7.25611 12.9543 4 24 4C35.0457 4 44 7.25611 44 11.2727Z" fill="currentColor"></path>
                </svg>
            </div>
            <h1 class="text-2xl font-bold text-gray-900">TalentMatch</h1>
        </div>
        <a href="/" class="text-[#2d608f] hover:text-[#1d4a6f] font-medium transition-colors">← Back to Home</a>
    </div>
</header>

<!-- Main Content -->
<main class="container max-w-4xl mx-auto py-12">
    <!-- Progress Header -->
    <div class="text-center mb-12 anim-fade">
        <h2 class="text-4xl font-bold text-gray-900 mb-4">Verify Your Information</h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            We've extracted information from your CV. Please verify and complete the details below to proceed.
        </p>
    </div>

    <!-- Progress Steps -->
    <div class="flex items-center justify-center mb-12 anim-slide" style="animation-delay: 0.2s;">
        <div class="flex items-center space-x-8">
            <div class="flex items-center">
                <div id="step1" class="step-indicator active">1</div>
                <span class="ml-2 text-sm font-medium text-gray-700">Basic Info</span>
            </div>
            <div class="w-16 h-1 bg-gray-200 rounded-full">
                <div id="progress1" class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="flex items-center">
                <div id="step2" class="step-indicator inactive">2</div>
                <span class="ml-2 text-sm font-medium text-gray-500">Positions</span>
            </div>
            <div class="w-16 h-1 bg-gray-200 rounded-full">
                <div id="progress2" class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="flex items-center">
                <div id="step3" class="step-indicator inactive">3</div>
                <span class="ml-2 text-sm font-medium text-gray-500">Review</span>
            </div>
        </div>
    </div>

    <!-- Verification Form -->
    <div class="verification-card glass-card rounded-2xl p-8 anim-fade" style="animation-delay: 0.4s;">
        <!-- Step 1: Basic Information -->
        <div id="stepContent1" class="step-content">
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Basic Information</h3>
                <p class="text-gray-600">Please verify your contact details extracted from your CV.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name</label>
                    <input id="fullName" type="text" class="form-input w-full px-4 py-3 rounded-xl" placeholder="Enter your full name">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                    <input id="email" type="email" class="form-input w-full px-4 py-3 rounded-xl" placeholder="your.email@example.com">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number</label>
                    <input id="phone" type="tel" class="form-input w-full px-4 py-3 rounded-xl" placeholder="050-123-4567">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Location *</label>
                    <select id="location" class="form-input custom-select w-full px-4 py-3 rounded-xl bg-white" required>
                        <option value="">בחר אזור / Select a region</option>
                        <option value="north">צפון / North (צפונית לחדרה / north of Hadera)</option>
                        <option value="center">מרכז / Central (הרצליה עד ראשון לציון / Herzliya to Rishon Lezion)</option>
                        <option value="lowlands">שפלה / Lowlands (ראשון לציון עד אשקלון / Rishon Lezion to Ashkelon)</option>
                        <option value="south">דרום / South (דרומית לאשקלון / south of Ashkelon)</option>
                    </select>
                </div>
            </div>

            <div class="flex justify-end mt-8">
                <button id="continueBtn1" class="btn-primary px-8 py-3 rounded-xl font-semibold">
                    Continue to Positions →
                </button>
            </div>
        </div>

        <!-- Step 2: Job Positions -->
        <div id="stepContent2" class="step-content hidden">
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Select Job Positions</h3>
                <p class="text-gray-600">Choose up to 4 positions that best match your experience and interests.</p>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-3">Search Position:</label>
                <div class="relative">
                    <input id="positionSearch" type="text" class="form-input w-full px-4 py-3 pr-10 rounded-xl" placeholder="Type a position name...">
                    <button id="clearSearch" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div id="searchResults" class="mb-6 hidden relative">
                <div class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-xl shadow-lg z-10 max-h-60 overflow-y-auto">
                    <div id="searchResultsContainer" class="p-2"></div>
                </div>
            </div>

            <div id="relatedPositions" class="mb-6 hidden">
                <p class="text-sm font-medium text-gray-700 mb-3">Related Positions:</p>
                <div id="relatedPositionsContainer" class="flex flex-wrap gap-3"></div>
            </div>

            <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                    <p class="text-sm font-medium text-gray-700">Selected positions:</p>
                    <span id="selectedCount" class="text-sm text-gray-500">0/4 selected</span>
                </div>
                <div id="selectedPositions" class="min-h-[60px] p-4 border-2 border-dashed border-gray-200 rounded-xl flex flex-wrap gap-2 items-center justify-center">
                    <p class="text-gray-400 text-sm">Select positions from above</p>
                </div>
            </div>

            <div class="flex justify-between mt-8">
                <button id="backBtn1" class="btn-secondary px-6 py-3 rounded-xl font-semibold">
                    ← Back
                </button>
                <button id="reviewBtn" class="btn-primary px-8 py-3 rounded-xl font-semibold opacity-50 cursor-not-allowed" disabled>
                    Review Information →
                </button>
            </div>
        </div>

        <!-- Step 3: Review & Submit -->
        <div id="stepContent3" class="step-content hidden">
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Review & Submit</h3>
                <p class="text-gray-600">Please review your information before submitting to our database.</p>
            </div>

            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Personal Information</h4>
                        <div class="space-y-2">
                            <p><span class="text-gray-500">Name:</span> <span id="reviewName" class="font-medium"></span></p>
                            <p><span class="text-gray-500">Email:</span> <span id="reviewEmail" class="font-medium"></span></p>
                            <p><span class="text-gray-500">Phone:</span> <span id="reviewPhone" class="font-medium"></span></p>
                            <p><span class="text-gray-500">Location:</span> <span id="reviewLocation" class="font-medium"></span></p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-700 mb-3">Selected Positions</h4>
                        <div id="reviewPositions" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="flex items-center space-x-3 cursor-pointer">
                    <input id="agreeTerms" type="checkbox" class="w-5 h-5 text-[#2d608f] border-2 border-gray-300 rounded focus:ring-[#2d608f]">
                    <span class="text-sm text-gray-700">
                            I agree to the <a href="#" class="text-[#2d608f] hover:underline">Privacy Policy</a> and
                            <a href="#" class="text-[#2d608f] hover:underline">Terms of Service</a>
                        </span>
                </label>
            </div>

            <div class="flex justify-between mt-8">
                <button id="backBtn2" class="btn-secondary px-6 py-3 rounded-xl font-semibold">
                    ← Back
                </button>
                <button id="submitBtn" class="btn-primary px-8 py-3 rounded-xl font-semibold opacity-50 cursor-not-allowed" disabled>
                    Submit Application
                </button>
            </div>
        </div>
    </div>
</main>

<!-- Success Modal -->
<div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-8 max-w-md mx-4 success-animation">
        <div class="text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">Successfully Submitted!</h3>
            <p class="text-gray-600 mb-6">Your information has been added to our talent database. We'll contact you when relevant opportunities arise.</p>
            <button id="goHomeBtn" class="btn-primary px-6 py-3 rounded-xl font-semibold w-full">
                Return to Home
            </button>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="errorModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-8 max-w-md mx-4">
        <div class="text-center">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </div>
            <h3 class="text-2xl font-bold text-gray-900 mb-2">Submission Failed</h3>
            <p id="errorMessage" class="text-gray-600 mb-6">An error occurred while submitting your application.</p>
            <button id="closeErrorBtn" class="btn-primary px-6 py-3 rounded-xl font-semibold w-full">
                Try Again
            </button>
        </div>
    </div>
</div>

<script>
    let currentStep = 1;
    let selectedPositions = [];
    let cvData = {};
    const allPositions = [
        // Administration
        {title: "Graphics", category: "Administration", related: ["Design", "Web Designer"]},
        {title: "Bookkeeping", category: "Administration", related: ["Payroll Accountant", "Certified Public Accountant"]},
        {title: "Payroll Accountant", category: "Administration", related: ["Bookkeeping", "Economics"]},
        {title: "Import and Export", category: "Administration", related: ["International Sales and Marketing", "Logistics"]},
        {title: "Call Center", category: "Administration", related: ["Customer Service", "Phone Support"]},
        {title: "Secretary", category: "Administration", related: ["Senior Secretary", "Office Management"]},
        {title: "Senior Secretary", category: "Administration", related: ["Secretary", "Administration Management"]},
        {title: "Administration Management", category: "Administration", related: ["Office Management", "Senior Secretary"]},
        {title: "Office Management", category: "Administration", related: ["Administration Management", "Clerical Work"]},
        {title: "Clerical Work", category: "Administration", related: ["Typing", "Office Management"]},
        {title: "Typing", category: "Administration", related: ["Clerical Work", "Secretary"]},
        {title: "Purchasing", category: "Administration", related: ["Import and Export", "Warehouse/Logistics"]},
        {title: "Customer Service", category: "Administration", related: ["Call Center", "Phone Support"]},

        // Electronics
        {title: "Electro-optics", category: "Electronics", related: ["Electronics Technician", "Electronics Engineer"]},
        {title: "Electronics Course Graduate or Experienced", category: "Electronics", related: ["Electronics Technician", "Electronics Engineer"]},
        {title: "Electronics Technician", category: "Electronics", related: ["Electronics Engineer", "Electronics Course Graduate or Experienced"]},
        {title: "Electronics Engineer", category: "Electronics", related: ["Electronics Technician", "System Engineer - Hardware"]},
        {title: "System Engineer - Hardware", category: "Electronics", related: ["Electronics Engineer", "Hardware Engineer"]},
        {title: "Hardware Engineer", category: "Electronics", related: ["System Engineer - Hardware", "Team Lead - Hardware"]},

        // Computers
        {title: "AI / ML", category: "Computers", related: ["Data Engineer/Scientist", "Big Data / BI / OLAP"]},
        {title: "Big Data / BI / OLAP", category: "Computers", related: ["Data Engineer/Scientist", "AI / ML"]},
        {title: "Data Engineer/Scientist", category: "Computers", related: ["AI / ML", "Big Data / BI / OLAP"]},
        {title: "DBA", category: "Computers", related: ["System Administrator", "Information Systems"]},
        {title: "DevOps", category: "Computers", related: ["System Administrator", "System Engineer - Software"]},
        {title: "Help Desk", category: "Computers", related: ["PC Technician", "Phone Support"]},
        {title: "PC Technician", category: "Computers", related: ["Help Desk", "Support Engineer"]},
        {title: "QA / Quality Assurance", category: "Computers", related: ["Quality Control", "Software Developer"]},
        {title: "System Administrator", category: "Computers", related: ["DevOps", "DBA"]},
        {title: "Web Master", category: "Computers", related: ["Web Designer", "Software Developer"]},
        {title: "Information Security", category: "Computers", related: ["System Administrator", "Computer Networking"]},
        {title: "Algorithm Engineer", category: "Computers", related: ["Software Engineer", "AI / ML"]},
        {title: "Computer Science Graduate/Certified", category: "Computers", related: ["Computer Technician", "Software Developer"]},
        {title: "Computer Technician", category: "Computers", related: ["Software Engineer", "Computer Science Graduate/Certified"]},
        {title: "Telephony", category: "Computers", related: ["Computer Networking", "Call Center"]},
        {title: "Technical Writer", category: "Computers", related: ["Information Systems", "Systems Analysis"]},
        {title: "Software Engineer", category: "Computers", related: ["Software Developer", "Senior Software Developer"]},
        {title: "System Engineer - Software", category: "Computers", related: ["Software Engineer", "DevOps"]},
        {title: "Support Engineer", category: "Computers", related: ["Help Desk", "PC Technician"]},
        {title: "Project Manager", category: "Computers", related: ["Team Lead - Software", "Project Manager"]},
        {title: "Web Designer", category: "Computers", related: ["Web Master", "Design"]},
        {title: "Information Systems", category: "Computers", related: ["Systems Analysis", "DBA"]},
        {title: "Software Developer", category: "Computers", related: ["Software Engineer", "Senior Software Developer"]},
        {title: "Senior Software Developer", category: "Computers", related: ["Software Developer", "Team Lead - Software"]},
        {title: "Systems Analysis", category: "Computers", related: ["Information Systems", "Technical Writer"]},
        {title: "Mobile Development - Android / iOS", category: "Computers", related: ["Software Developer", "Web Designer"]},
        {title: "Team Lead - Hardware", category: "Computers", related: ["Hardware Engineer", "Team Lead - Software"]},
        {title: "Team Lead - Software", category: "Computers", related: ["Senior Software Developer", "Project Manager"]},
        {title: "Computer Networking", category: "Computers", related: ["System Administrator", "Information Security"]},

        // Additional categories
        {title: "Senior Manager", category: "Senior Management", related: ["CEO", "VP"]},
        {title: "Marketing", category: "Sales/Marketing/Communications", related: ["Sales", "Advertising, Public Relations, and Communications"]},
        {title: "Teaching/Training/Education", category: "Liberal/Academic Professions", related: ["Special Education", "Psychology"]},
        {title: "Nurses/Caregivers/Nursing", category: "General Professions", related: ["Medicine", "Social Work"]},
    ];

    const fuse = new Fuse(allPositions, {
        keys: ['title'],
        threshold: 0.3,
        includeScore: true
    });

    // Event listeners setup
    function setupEventListeners() {
        // Navigation buttons
        document.getElementById('continueBtn1').addEventListener('click', () => nextStep(1));
        document.getElementById('backBtn1').addEventListener('click', () => prevStep(2));
        document.getElementById('reviewBtn').addEventListener('click', () => nextStep(2));
        document.getElementById('backBtn2').addEventListener('click', () => prevStep(3));
        document.getElementById('submitBtn').addEventListener('click', submitForm);

        // Modal buttons
        document.getElementById('goHomeBtn').addEventListener('click', goHome);
        document.getElementById('closeErrorBtn').addEventListener('click', closeErrorModal);

        // Search functionality
        document.getElementById('positionSearch').addEventListener('input', searchPositions);
        document.getElementById('clearSearch').addEventListener('click', clearSearch);

        // Form validation
        document.getElementById('agreeTerms').addEventListener('change', toggleSubmitButton);

        // Input formatting
        setupInputFormatting();

        // Click outside to close search results
        document.addEventListener('click', handleOutsideClick);

        // Keyboard navigation
        document.addEventListener('keydown', handleKeyNavigation);
    }

    function setupInputFormatting() {
        // Name validation
        document.getElementById('fullName').addEventListener('input', function() {
            this.value = this.value.replace(/[^a-zA-Z\u0590-\u05FF\s\-\.\']/g, '');
            saveFormData();
        });

        // Phone formatting
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');

            if (value.startsWith('972')) {
                value = value.substring(3);
            }
            if (value.startsWith('0')) {
                value = value.substring(1);
            }

            if (value.length >= 9) {
                if (value.startsWith('5')) {
                    e.target.value = '05' + value.substring(1, 2) + '-' + value.substring(2, 5) + '-' + value.substring(5, 9);
                } else {
                    e.target.value = '0' + value.substring(0, 1) + '-' + value.substring(1, 4) + '-' + value.substring(4, 8);
                }
            } else {
                e.target.value = value;
            }
            saveFormData();
        });

        // Email validation on blur
        document.getElementById('email').addEventListener('blur', function() {
            const email = this.value.trim();
            if (email && !isValidEmail(email)) {
                this.style.borderColor = '#ef4444';
                this.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
            } else {
                this.style.borderColor = '#e1e5e9';
                this.style.boxShadow = 'none';
            }
        });

        document.getElementById('email').addEventListener('input', saveFormData);
        document.getElementById('location').addEventListener('change', saveFormData);
    }

    function handleOutsideClick(e) {
        const searchInput = document.getElementById('positionSearch');
        const searchResults = document.getElementById('searchResults');

        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.classList.add('hidden');
        }
    }

    function handleKeyNavigation(event) {
        if (event.key === 'Enter') {
            if (currentStep === 1) {
                nextStep(1);
            } else if (currentStep === 2 && selectedPositions.length > 0) {
                nextStep(2);
            } else if (currentStep === 3 && document.getElementById('agreeTerms').checked) {
                submitForm();
            }
        }
    }

    function searchPositions() {
        const query = document.getElementById('positionSearch').value;
        const resultsContainer = document.getElementById('searchResults');
        const clearBtn = document.getElementById('clearSearch');

        if (query.length > 0) {
            clearBtn.classList.remove('hidden');
        } else {
            clearBtn.classList.add('hidden');
        }

        if (query.length < 2) {
            resultsContainer.classList.add('hidden');
            return;
        }

        const results = fuse.search(query);
        displaySearchResults(results);
    }

    function clearSearch() {
        document.getElementById('positionSearch').value = '';
        document.getElementById('searchResults').classList.add('hidden');
        document.getElementById('clearSearch').classList.add('hidden');
    }

    function displaySearchResults(results) {
        const container = document.getElementById('searchResultsContainer');
        const resultsDiv = document.getElementById('searchResults');

        container.innerHTML = results.slice(0, 5).map(result => {
            const escapedTitle = result.item.title.replace(/'/g, '\\\'');
            const escapedCategory = result.item.category.replace(/'/g, '\\\'');
            const escapedRelated = JSON.stringify(result.item.related).replace(/"/g, '&quot;');

            return `<div class="search-result-item px-4 py-2 hover:bg-gray-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0" data-title="${escapedTitle}" data-category="${escapedCategory}" data-related="${escapedRelated}">
                ${result.item.title}
                <span class="text-xs text-gray-500 ml-2">(${result.item.category})</span>
            </div>`;
        }).join('');

        // Add click listeners to search results
        container.querySelectorAll('.search-result-item').forEach(item => {
            item.addEventListener('click', function() {
                const title = this.getAttribute('data-title');
                const category = this.getAttribute('data-category');
                const related = JSON.parse(this.getAttribute('data-related').replace(/&quot;/g, '"'));
                selectPosition(title, category, related);
            });
        });

        resultsDiv.classList.remove('hidden');
    }

    function selectPosition(title, category, related) {
        if (selectedPositions.length >= 4) {
            alert('You can select maximum 4 positions.');
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('positionSearch').value = '';
            return;
        }

        if (!selectedPositions.find(p => p.title === title)) {
            selectedPositions.push({title, category});
            updateSelectedPositions();
            showRelatedPositions(related);
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('positionSearch').value = '';
            saveFormData();
        }
    }

    function showRelatedPositions(related) {
        const container = document.getElementById('relatedPositionsContainer');
        const relatedDiv = document.getElementById('relatedPositions');

        container.innerHTML = related.map(pos =>
            `<div class="related-position job-tag px-4 py-2 rounded-lg text-sm font-medium cursor-pointer border-2 border-dashed border-blue-200 hover:border-solid hover:border-blue-400 transition-all" data-position="${pos}">
                <span class="text-blue-600">💡</span> ${pos}
            </div>`
        ).join('');

        // Add click listeners to related positions
        container.querySelectorAll('.related-position').forEach(item => {
            item.addEventListener('click', function() {
                const positionTitle = this.getAttribute('data-position');
                selectFromRelated(positionTitle);
            });
        });

        relatedDiv.classList.remove('hidden');
    }

    function selectFromRelated(positionTitle) {
        const position = allPositions.find(p => p.title === positionTitle);
        if (position) {
            selectPosition(position.title, position.category, position.related);
        }
    }

    function updateSelectedPositions() {
        const container = document.getElementById('selectedPositions');
        const countElement = document.getElementById('selectedCount');
        const reviewBtn = document.getElementById('reviewBtn');

        countElement.textContent = `${selectedPositions.length}/4 selected`;

        if (selectedPositions.length === 0) {
            container.innerHTML = '<p class="text-gray-400 text-sm">Select positions from above</p>';
            reviewBtn.disabled = true;
            reviewBtn.classList.add('opacity-50', 'cursor-not-allowed');
        } else {
            container.innerHTML = selectedPositions.map(pos => `
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                    ${pos.title}
                    <button class="remove-position ml-2 text-blue-600 hover:text-blue-800" data-title="${pos.title}">×</button>
                </span>
            `).join('');

            // Add click listeners to remove buttons
            container.querySelectorAll('.remove-position').forEach(btn => {
                btn.addEventListener('click', function() {
                    const title = this.getAttribute('data-title');
                    removePosition(title);
                });
            });

            reviewBtn.disabled = false;
            reviewBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    }

    function removePosition(positionTitle) {
        selectedPositions = selectedPositions.filter(p => p.title !== positionTitle);
        updateSelectedPositions();
        saveFormData();
    }

    function nextStep(step) {
        if (step === 1) {
            const name = document.getElementById('fullName').value.trim();
            const email = document.getElementById('email').value.trim();
            const location = document.getElementById('location').value;

            if (!name) {
                alert('Please fill in your name.');
                return;
            }

            if (!email) {
                alert('Please fill in your email address.');
                return;
            }

            if (!isValidEmail(email)) {
                alert('Please enter a valid email address.');
                return;
            }

            if (!location) {
                alert('Please select a location.');
                return;
            }

            // Move to step 2
            document.getElementById('stepContent1').classList.add('hidden');
            document.getElementById('stepContent2').classList.remove('hidden');

            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.remove('inactive');
            document.getElementById('step2').classList.add('active');

            document.getElementById('progress1').style.width = '100%';
            currentStep = 2;
        }

        if (step === 2) {
            if (selectedPositions.length === 0) {
                alert('Please select at least one position.');
                return;
            }

            // Move to step 3
            document.getElementById('stepContent2').classList.add('hidden');
            document.getElementById('stepContent3').classList.remove('hidden');

            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.remove('inactive');
            document.getElementById('step3').classList.add('active');

            document.getElementById('progress2').style.width = '100%';

            updateReview();
            currentStep = 3;
        }
    }

    function prevStep(step) {
        if (step === 2) {
            document.getElementById('stepContent2').classList.add('hidden');
            document.getElementById('stepContent1').classList.remove('hidden');

            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('inactive');
            document.getElementById('step1').classList.remove('completed');
            document.getElementById('step1').classList.add('active');

            document.getElementById('progress1').style.width = '0%';
            currentStep = 1;
        }

        if (step === 3) {
            document.getElementById('stepContent3').classList.add('hidden');
            document.getElementById('stepContent2').classList.remove('hidden');

            document.getElementById('step3').classList.remove('active');
            document.getElementById('step3').classList.add('inactive');
            document.getElementById('step2').classList.remove('completed');
            document.getElementById('step2').classList.add('active');

            document.getElementById('progress2').style.width = '0%';
            currentStep = 2;
        }
    }

    function updateReview() {
        document.getElementById('reviewName').textContent = document.getElementById('fullName').value;
        document.getElementById('reviewEmail').textContent = document.getElementById('email').value;
        document.getElementById('reviewPhone').textContent = document.getElementById('phone').value || 'Not provided';

        const locationSelect = document.getElementById('location');
        const locationText = locationSelect.options[locationSelect.selectedIndex].text;
        document.getElementById('reviewLocation').textContent = locationText || 'Not specified';

        const positionsContainer = document.getElementById('reviewPositions');
        positionsContainer.innerHTML = selectedPositions.map(pos => `
            <p class="text-gray-700">• ${pos.title} <span class="text-sm text-gray-500">(${pos.category})</span></p>
        `).join('');
    }

    function toggleSubmitButton() {
        const agreeTerms = document.getElementById('agreeTerms').checked;
        const submitBtn = document.getElementById('submitBtn');

        if (agreeTerms) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    async function submitForm() {
        const loader = document.getElementById('loader');
        const submitBtn = document.getElementById('submitBtn');

        try {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            loader.classList.remove('hidden');

            const formData = {
                name: document.getElementById('fullName').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim() || '',
                location: document.getElementById('location').value,
                positions: selectedPositions,
                metadata: cvData.metadata || {},
                source: 'verification_form'
            };

            console.log('Submitting form data:', formData);

            // Replace with your actual API endpoint
            const response = await fetch('/api/candidates/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': 'your-api-key-here' // Add your API key if required
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || 'Submission failed');
            }

            // Clear session data
            clearSavedData();

            // Hide loader and show success modal
            loader.classList.add('hidden');
            submitBtn.textContent = 'Submit Application';
            document.getElementById('successModal').classList.remove('hidden');

        } catch (error) {
            console.error('Submit error:', error);
            loader.classList.add('hidden');

            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Application';

            // Show error modal with specific message
            document.getElementById('errorMessage').textContent =
                error.message || 'An error occurred while submitting your application. Please try again.';
            document.getElementById('errorModal').classList.remove('hidden');
        }
    }

    function goHome() {
        window.location.href = '/';
    }

    function closeErrorModal() {
        document.getElementById('errorModal').classList.add('hidden');
        // Re-enable submit button
        const submitBtn = document.getElementById('submitBtn');
        if (document.getElementById('agreeTerms').checked) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    }

    function saveFormData() {
        const formData = {
            name: document.getElementById('fullName').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            location: document.getElementById('location').value,
            selectedPositions: selectedPositions,
            currentStep: currentStep
        };
        sessionStorage.setItem('formData', JSON.stringify(formData));
    }

    function loadFormData() {
        const storedFormData = sessionStorage.getItem('formData');
        if (storedFormData) {
            try {
                const formData = JSON.parse(storedFormData);

                if (formData.name) document.getElementById('fullName').value = formData.name;
                if (formData.email) document.getElementById('email').value = formData.email;
                if (formData.phone) document.getElementById('phone').value = formData.phone;
                if (formData.location) document.getElementById('location').value = formData.location;

                if (formData.selectedPositions && Array.isArray(formData.selectedPositions)) {
                    selectedPositions = formData.selectedPositions;
                    updateSelectedPositions();
                }
            } catch (e) {
                console.error('Error loading form data:', e);
            }
        }
    }

    function clearSavedData() {
        sessionStorage.removeItem('formData');
        sessionStorage.removeItem('cvData');
    }

    function populateFormData() {
        console.log('Available cvData:', cvData);

        if (!cvData) {
            console.warn('No CV data found');
            return;
        }

        // Handle both direct data and nested data structure
        const data = cvData.data || cvData;

        // Populate fields with extracted data
        if (data.name && data.name.trim()) {
            document.getElementById('fullName').value = data.name.trim();
            console.log('Populated name:', data.name);
        }

        if (data.email && data.email.trim()) {
            document.getElementById('email').value = data.email.trim().toLowerCase();
            console.log('Populated email:', data.email);
        }

        if (data.phone && data.phone.trim()) {
            document.getElementById('phone').value = data.phone.trim();
            console.log('Populated phone:', data.phone);
        }
    }

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing verification form...');

        // Load CV data from session storage FIRST
        const storedData = sessionStorage.getItem('cvData');
        console.log('Raw stored data:', storedData);

        if (storedData) {
            try {
                cvData = JSON.parse(storedData);
                console.log('Parsed CV data:', cvData);
            } catch (e) {
                console.error('Error parsing stored CV data:', e);
                cvData = {};
            }
        } else {
            console.warn('No CV data found in session storage');
            cvData = {};
        }

        // Setup event listeners
        setupEventListeners();

        // THEN populate form data
        setTimeout(() => {
            populateFormData();
            // Load any previously saved form data (this will override CV data if form was partially filled)
            loadFormData();
        }, 100);

        console.log('Verification form initialized successfully');
    });

    // Handle browser back button
    window.addEventListener('popstate', function(event) {
        if (currentStep > 1) {
            event.preventDefault();
            if (currentStep === 2) {
                prevStep(2);
            } else if (currentStep === 3) {
                prevStep(3);
            }
        }
    });
</script>
</body>
</html>